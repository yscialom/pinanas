{%- import 'secrets.j2' as secrets with context -%}
{
    "backup": {
      "database": {
        "cronExpression": "0 02 * * *",
        "enabled": true,
        "keepLastAmount": 14
      }
    },
    "ffmpeg": {
      "accel": "disabled",
      "accelDecode": false,
      "acceptedAudioCodecs": [
        "aac",
        "mp3",
        "libopus",
        "pcm_s16le"
      ],
      "acceptedContainers": [
        "mov",
        "ogg",
        "webm"
      ],
      "acceptedVideoCodecs": [
        "h264"
      ],
      "bframes": -1,
      "cqMode": "auto",
      "crf": 23,
      "gopSize": 0,
      "maxBitrate": "0",
      "preferredHwDevice": "auto",
      "preset": "ultrafast",
      "refs": 0,
      "targetAudioCodec": "aac",
      "targetResolution": "720",
      "targetVideoCodec": "h264",
      "temporalAQ": false,
      "threads": 0,
      "tonemap": "hable",
      "transcode": "required",
      "twoPass": false
    },
    "image": {
      "colorspace": "p3",
      "extractEmbedded": false,
      "fullsize": {
        "enabled": false,
        "format": "jpeg",
        "quality": 80
      },
      "preview": {
        "format": "jpeg",
        "quality": 80,
        "size": 1440
      },
      "thumbnail": {
        "format": "jpeg",
        "quality": 80,
        "size": 250
      }
    },
    "job": {
      "backgroundTask": {
        "concurrency": 5
      },
      "faceDetection": {
        "concurrency": 2
      },
      "library": {
        "concurrency": 5
      },
      "metadataExtraction": {
        "concurrency": 5
      },
      "migration": {
        "concurrency": 5
      },
      "notifications": {
        "concurrency": 5
      },
      "search": {
        "concurrency": 5
      },
      "sidecar": {
        "concurrency": 5
      },
      "smartSearch": {
        "concurrency": 2
      },
      "thumbnailGeneration": {
        "concurrency": 3
      },
      "videoConversion": {
        "concurrency": 1
      }
    },
    "library": {
      "scan": {
        "cronExpression": "0 0 * * *",
        "enabled": true
      },
      "watch": {
        "enabled": false
      }
    },
    "logging": {
      "enabled": true,
      "level": "log"
    },
    "machineLearning": {
      "clip": {
        "enabled": true,
        "modelName": "ViT-B-32__openai"
      },
      "duplicateDetection": {
        "enabled": true,
        "maxDistance": 0.01
      },
      "enabled": true,
      "facialRecognition": {
        "enabled": true,
        "maxDistance": 0.5,
        "minFaces": 3,
        "minScore": 0.7,
        "modelName": "buffalo_l"
      },
      "urls": [
        "http://immich-machine-learning:3003"
      ]
    },
    "map": {
      "darkStyle": "https://tiles.immich.cloud/v1/style/dark.json",
      "enabled": false,
      "lightStyle": "https://tiles.immich.cloud/v1/style/light.json"
    },
    "metadata": {
      "faces": {
        "import": false
      }
    },
    "newVersionCheck": {
      "enabled": false
    },
    "notifications": {
      "smtp": {
        "enabled": true,
        "from": "{{ pinanas.network.smtp.sender }}",
        "replyTo": "",
        "transport": {
          "host": "{{ pinanas.network.smtp.host }}",
          "password": "{{ pinanas.network.smtp.password }}",
          "port": {{ pinanas.network.smtp.port }},
          "username": "{{ pinanas.network.smtp.username }}",
          "ignoreCert": false
        }
      }
    },
    "oauth": {
      "autoLaunch": false,
      "autoRegister": true,
      "buttonText": "Login with Authelia",
      "clientId": "immich",
      "clientSecret": "{{ secrets.make_secret('pinanas.authelia.identity_providers.oidc.clients[immich].secret')[:16] }}",
      "defaultStorageQuota": 100,
      "enabled": true,
      "issuerUrl": "https://auth.{{ pinanas.domain }}{{ ":" ~ pinanas.ports.https if pinanas.ports.https != 443 else "" }}",
      "mobileOverrideEnabled": false,
      "mobileRedirectUri": "",
      "profileSigningAlgorithm": "none",
      "scope": "openid email profile groups",
      "signingAlgorithm": "RS256",
      "storageLabelClaim": "preferred_username",
      "storageQuotaClaim": "immich_quota",
      "timeout": 30000,
      "tokenEndpointAuthMethod": "client_secret_post"
    },
    "passwordLogin": {
      "enabled": true
    },
    "reverseGeocoding": {
      "enabled": true
    },
    "server": {
      "externalDomain": "",
      "loginPageMessage": "",
      "publicUsers": true
    },
    "storageTemplate": {
      "enabled": false,
      "hashVerificationEnabled": true,
      "template": "{% raw %}{{y}}/{{y}}-{{MM}}-{{dd}}/{{filename}}{% endraw %}"
    },
    "templates": {
      "email": {
        "albumInviteTemplate": "",
        "albumUpdateTemplate": "",
        "welcomeTemplate": ""
      }
    },
    "theme": {
      "customCss": ""
    },
    "trash": {
      "days": 30,
      "enabled": true
    },
    "user": {
      "deleteDelay": 7
    }
  }
